#!/bin/bash

touch /var/log/Config.bootup
exec 0<> >(/usr/bin/tee /var/log/Config.bootup > /dev/tty9) 1>&0 2>&0
export NOW="`date`"

echo "------------------------------------------------------------------------------"
echo "------------------------------------------------------------------------------"
echo $0 started on $NOW.
echo "------------------------------------------------------------------------------"
sleep 60

#
# make sure a matching /etc/psdevtab exists
#
rm -f /etc/psdevtab
ps > /dev/null

#
# make sure, that we have no "future files" in kernel sources
#
TMPDIR=`mktemp -d /tmp/nowXXXXXX`

touch $TMPDIR/now

find /usr/src/linux* -newer $TMPDIR/now 2>/dev/null | \
    xargs --no-run-if-empty touch

rm -rf $TMPDIR


# 
# make sure, that texhash will be started in SuSEconfig.
#
mkdir -p /var/adm/SuSEconfig
touch /var/adm/SuSEconfig/run-texhash


#
# Run SuSEconfig
#
/sbin/SuSEconfig
echo " "
echo " "
# echo -n "Running /root/bin/cron.daily..."
# /root/bin/cron.daily
# echo "done"
echo " "
echo " "
echo "            Have a lot of fun!"
echo " "
echo " "
echo "                              Your S.u.S.E. Team"
echo " "
echo " "
rm -f /usr/lib/YaST/.configured2
mkdir -p /var/adm/notify/messages
echo "Hi,

Congratulation! The installation seems to be finished.  

Here is the protocol of configuration started at boot up time (as found
in /var/log/Config.bootup) :

" > /var/adm/notify/messages/Config.bootup
cat /var/log/Config.bootup >> /var/adm/notify/messages/Config.bootup
exit 0
