#!/bin/bash

touch /var/log/Config.bootup
exec 0<> >(/usr/bin/tee /var/log/Config.bootup > /dev/tty9) 1>&0 2>&0
export NOW="`date`"

echo "------------------------------------------------------------------------------"
echo "------------------------------------------------------------------------------"
echo $0 started on $NOW.
echo "------------------------------------------------------------------------------"
sleep 60

#
# make sure a matching /etc/psdevtab exists
#
rm -f /etc/psdevtab
ps > /dev/null

if test -x /usr/bin/h2ph -a -d /usr/include \
	-a ! -e /usr/lib/YaST/.DemoMode  ; then
    echo -n Setting up perl...
    (
    cd /usr/include
    for h in *.h sys/*.h linux/*.h ; do
	test -f $h && /usr/bin/h2ph $h  > /dev/null
    done
    )
    echo done.
fi

# 
# update database for tetex
#
if test -x /usr/bin/TeX/texhash ; then
    # maybe /var/texfonts is mounted via nfs with root_squash. This could
    # lead into trouble, so omit nfs directories.
    for DUMMY in `find /var/texfonts -prune -type d ! -fstype nfs 2> /dev/null` ; do
        echo Running texhash...
        /usr/bin/TeX/texhash 
    done
fi



/sbin/SuSEconfig
echo " "
echo " "
# echo -n "Running /root/bin/cron.daily..."
# /root/bin/cron.daily
# echo "done"
echo " "
echo " "
echo "            Have a lot of fun!"
echo " "
echo " "
echo "                              Your S.u.S.E. Team"
echo " "
echo " "
rm -f /usr/lib/YaST/.configured2
mkdir -p /var/adm/notify/messages
echo "Hi,

Congratulation! The installation seems to be finished.  

Here is the protocol of configuration started at boot up time (as found
in /var/log/Config.bootup) :

" > /var/adm/notify/messages/Config.bootup
cat /var/log/Config.bootup >> /var/adm/notify/messages/Config.bootup
exit 0
